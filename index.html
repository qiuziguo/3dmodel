<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>关公像 AR - 全平台兼容</title>
    
    <!-- Model Viewer for fallback -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.2);
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
            color: #FFD700;
        }
        
        .ios-ar-section {
            padding: 20px;
            text-align: center;
            background: rgba(255,255,255,0.1);
            margin: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .ar-button {
            display: inline-block;
            background: linear-gradient(45deg, #FF6B6B, #FF8E8E);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .ar-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        
        .fallback-section {
            margin-top: 20px;
        }
        
        model-viewer {
            width: 100%;
            height: 400px;
            background-color: transparent;
            --poster-color: transparent;
        }
        
        .platform-info {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px;
            font-size: 14px;
        }
        
        .ios-only {
            display: none;
        }
        
        .non-ios {
            display: block;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            model-viewer {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏮 关公像 AR 体验</h1>
        <p id="platform-indicator">全平台兼容版本</p>
    </div>
    
    <!-- iOS AR Section -->
    <div class="ios-ar-section">
        <h2>📱 iOS 原生 AR</h2>
        <p>使用 Apple AR Quick Look 技术</p>
        
        <a href="https://qiuziguo.github.io/3dmodel/einscan_pro_hd_statue_of_guan_gong/model.usdz" 
           rel="ar" 
           class="ar-button"
           id="usdz-button">
            🚀 启动 iOS AR 体验
        </a>
        
        <div class="platform-info ios-only">
            <h3>✅ iOS 设备检测成功</h3>
            <p>• 点击上方按钮即可体验原生 AR</p>
            <p>• 支持表面检测和手势控制</p>
            <p>• 无需额外应用，Safari 直接打开</p>
        </div>
        
        <div class="platform-info non-ios">
            <h3>📱 针对您的设备</h3>
            <p id="device-message">检测设备类型中...</p>
        </div>
    </div>
    
    <!-- Fallback 3D Viewer -->
    <div class="fallback-section">
        <h2 style="text-align: center; margin: 20px;">🔄 3D 交互查看器</h2>
        
        <model-viewer
            id="guan-gong-viewer"
            src="https://qiuziguo.github.io/3dmodel/einscan_pro_hd_statue_of_guan_gong/scene.gltf"
            alt="关公像 3D 模型"
            auto-rotate
            auto-rotate-delay="3000"
            rotation-per-second="20deg"
            camera-controls
            touch-action="pan-y"
            disable-zoom="false"
            environment-image="neutral"
            shadow-intensity="1"
            camera-orbit="0deg 75deg 2.5m"
            field-of-view="30deg"
            loading="eager">
            
            <div slot="progress-bar" style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 18px;
            ">
                加载中... ⏳
            </div>
        </model-viewer>
        
        <div style="text-align: center; padding: 20px; background: rgba(0,0,0,0.3); margin: 0 20px; border-radius: 10px;">
            <p><strong>3D 查看器功能：</strong></p>
            <p>🔄 拖拽旋转 • 📏 双指缩放 • ⏯️ 自动旋转</p>
        </div>
    </div>

    <script>
        // Device detection
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }
        
        function isAndroid() {
            return /Android/.test(navigator.userAgent);
        }
        
        function supportsARQuickLook() {
            const a = document.createElement('a');
            return a.relList && a.relList.supports && a.relList.supports('ar');
        }
        
        function supportsWebXR() {
            return 'xr' in navigator;
        }
        
        // Update UI based on device
        function updateDeviceUI() {
            const platformIndicator = document.getElementById('platform-indicator');
            const deviceMessage = document.getElementById('device-message');
            const iosOnlyElements = document.querySelectorAll('.ios-only');
            const nonIosElements = document.querySelectorAll('.non-ios');
            
            if (isIOS()) {
                platformIndicator.textContent = 'iOS 设备 - 原生 AR 支持';
                iosOnlyElements.forEach(el => el.style.display = 'block');
                nonIosElements.forEach(el => el.style.display = 'none');
                
                if (supportsARQuickLook()) {
                    deviceMessage.innerHTML = '✅ 支持 iOS AR Quick Look<br>点击上方按钮体验原生 AR';
                } else {
                    deviceMessage.innerHTML = '⚠️ 需要 iOS 12+ 和 Safari 浏览器';
                }
            } else if (isAndroid()) {
                platformIndicator.textContent = 'Android 设备';
                deviceMessage.innerHTML = isAndroid() && supportsWebXR() ? 
                    '🤖 Android 设备检测到<br>🎯 <a href="./index.html" style="color: #4CAF50;">点击这里体验 WebXR AR</a>' :
                    '🤖 Android 设备检测到<br>📱 使用下方 3D 查看器或尝试 Chrome 浏览器的 WebXR 功能';
            } else {
                platformIndicator.textContent = '桌面设备';
                deviceMessage.innerHTML = '💻 桌面设备检测到<br>📱 使用下方 3D 查看器查看模型';
            }
        }
        
        // Handle USDZ button click
        document.getElementById('usdz-button').addEventListener('click', function(e) {
            if (!isIOS()) {
                e.preventDefault();
                if (isAndroid()) {
                    alert('Android 设备请使用下方的 3D 查看器，或访问 WebXR 版本体验 AR');
                } else {
                    alert('此 AR 功能需要在 iOS 设备（iPhone/iPad）上使用');
                }
                return;
            }
            
            if (!supportsARQuickLook()) {
                e.preventDefault();
                alert('需要 iOS 12+ 和 Safari 浏览器支持 AR Quick Look');
                return;
            }
        });
        
        // Initialize
        window.addEventListener('load', updateDeviceUI);
        
        // Model viewer events
        const modelViewer = document.querySelector('#guan-gong-viewer');
        
        modelViewer.addEventListener('load', () => {
            console.log('3D 模型加载成功');
        });
        
        modelViewer.addEventListener('error', (error) => {
            console.error('模型加载失败:', error);
        });
    </script>
</body>
</html>
